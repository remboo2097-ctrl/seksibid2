<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>OSIS Sekbid 2 â€” Postingan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { box-sizing: border-box; }
        .nav-scrollbar::-webkit-scrollbar { height: 8px; }
        .nav-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        .nav-scrollbar::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .nav-scrollbar::-webkit-scrollbar-thumb:hover { background: #2563eb; }
        .photo-gallery::-webkit-scrollbar { height: 12px; }
        .photo-gallery::-webkit-scrollbar-track { background: #f8fafc; border-radius: 10px; }
        .photo-gallery::-webkit-scrollbar-thumb { background: #64748b; border-radius: 10px; }
        .photo-gallery::-webkit-scrollbar-thumb:hover { background: #475569; }
        .fade-in { animation: fadeIn 0.45s ease-in; }
        @keyframes bounceSlow {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}
.animate-bounce-slow {
  animation: bounceSlow 2s infinite;
}

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-10px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        header { position: relative; z-index: 20; }
        main { position: relative; z-index: 1; }
        #login-modal { z-index: 9999; }
        /* small helpers */
        .media-card:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 10px 25px rgba(2,6,23,0.08); }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center">
                        <img src="https://i.ibb.co/V0ZqpRFw/get-removebg-preview.png" alt="logo" class="w-10 h-10 object-contain">
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">OSIS Sekbid 2</h1>
                        <p class="text-sm text-gray-600">Organisasi Siswa Intra Sekolah</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-2 text-sm text-gray-600">
                    <span>ğŸ“… 2025</span>
                    <span>â€¢</span>
                    <span>ğŸ« Sekbid 2</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4">
            <div class="nav-scrollbar overflow-x-auto">
                <div class="flex justify-between items-center py-4">
                    <div class="flex space-x-1 min-w-max">
                        <button onclick="showSection('beranda')" id="nav-beranda" class="nav-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-blue-600 text-white">
                            ğŸ  Beranda
                        </button>
                        <button onclick="showSection('posting')" id="nav-posting" class="nav-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 text-gray-600 hover:bg-gray-100">
                            ğŸ“¢ Postingan
                        </button>
                        <button onclick="showSection('upload')" id="nav-upload" class="nav-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 text-gray-600 hover:bg-gray-100">
                            ğŸ“¤ Upload
                        </button>
                        <button onclick="showSection('kontak')" id="nav-kontak" class="nav-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 text-gray-600 hover:bg-gray-100">
                            ğŸ“ Kontak
                        </button>
                        <button onclick="showSection('tentang')" id="nav-tentang" class="nav-btn px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 text-gray-600 hover:bg-gray-100">
                            â„¹ï¸ Tentang Kami
                        </button>
                    </div>
                    <div class="flex items-center space-x-2 ml-4">
                        <div id="admin-status" class="hidden text-sm text-green-600 font-medium">ğŸ‘¤ Admin</div>
                        <button id="login-btn" onclick="showLoginModal()" class="px-4 py-2 bg-gray-600 text-white rounded-full text-sm font-medium hover:bg-gray-700 transition-colors duration-200">ğŸ” Login Admin</button>
                        <button id="logout-btn" onclick="logout()" class="hidden px-4 py-2 bg-red-600 text-white rounded-full text-sm font-medium hover:bg-red-700 transition-colors duration-200">ğŸšª Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Beranda -->
        <section id="beranda" class="section-content fade-in">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Selamat Datang di OSIS SMK AL-HADI Sekbid 2</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">Website resmi Organisasi Siswa Intra Sekolah Sekbid 2. Tempat berbagi dokumentasi kegiatan dan informasi terkini.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                    <div class="text-4xl mb-4">ğŸ¯</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Visi Kami</h3>
                    <p class="text-gray-600">Mewujudkan peserta didik yang berkarakter mulia, berbudi pekerti luhur, berakhlak Islami, dan membangun kepedulian siswa tentang kebersihan.</p>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                    <div class="text-4xl mb-4">ğŸš€</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Misi Kami</h3>
                    <p class="text-gray-600">Mengembangkan Program Pembiasaan seperti 5S dan membangun lingkungan sekolah yang harmonis.</p>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                    <div class="text-4xl mb-4">ğŸ¤</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Nilai Kami</h3>
                    <p class="text-gray-600">Integritas, kerjasama, inovasi, dan dedikasi untuk siswa siswi dan sekolah.</p>
                </div>
            </div>
        </section>

        <!-- Postingan (gabungan foto/video/dokumen) -->
        <!-- Header Postingan -->
        <section id="posting" class="section-content hidden">
<div class="text-center mb-8">
  <div class="flex justify-center items-center space-x-2 mb-3">
    <span class="text-4xl animate-bounce-slow">ğŸ“¢</span>
    <h2 class="text-4xl font-extrabold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent">
      Postingan
    </h2>
  </div>
  <p class="text-gray-600 text-base">ğŸ“¸ Semua konten menarik: foto, video, dan dokumen kegiatan OSIS Sekbid 2</p>
</div>

<!-- Card filter/search -->
<div class="bg-white shadow-md rounded-xl p-4 flex flex-col md:flex-row md:items-center md:justify-between mb-8 border border-gray-100">
  <div class="flex items-center space-x-2 mb-3 md:mb-0">
    <span class="text-sm text-gray-500">ğŸ“Š Total posting:</span>
    <span id="post-count" class="text-sm font-semibold text-blue-600">0</span>
  </div>
  <div class="flex items-center space-x-2 w-full md:w-auto">
    <div class="relative flex-1">
      <span class="absolute left-3 top-2.5 text-gray-400">ğŸ”</span>
      <input id="post-search" type="text" placeholder="Cari judul atau tag..."
        class="w-full md:w-64 pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-400 transition-all duration-200">
    </div>
    <select id="post-filter"
      class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
      <option value="">Semua</option>
      <option value="image">ğŸ“· Foto</option>
      <option value="video">ğŸ¥ Video</option>
      <option value="dokumen">ğŸ“„ Dokumen</option>
    </select>
  </div>
</div>

            <div id="posts-grid" class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <!-- Upload (satu form untuk semua tipe file) -->
        <section id="upload" class="section-content hidden">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“¤ Upload</h2>
                <p class="text-gray-600">Upload foto, video, atau dokumen. (Hanya admin)</p>
            </div>

            <div id="upload-access-denied" class="text-center py-20">
                <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8">
                    <div class="text-6xl mb-4">ğŸ”’</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Akses Terbatas</h2>
                    <p class="text-gray-600 mb-6">Halaman upload hanya dapat diakses oleh admin.</p>
                    <button onclick="showLoginModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">ğŸ” Login sebagai Admin</button>
                </div>
            </div>

            <div id="upload-form-container" class="hidden max-w-2xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <form id="universal-upload-form" class="space-y-6" enctype="multipart/form-data">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilih File (foto / video / dokumen)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors duration-200">
                                <input type="file" id="post-input" accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx" class="hidden">
                                <div onclick="document.getElementById('post-input').click()" class="cursor-pointer">
                                    <div class="text-4xl mb-2">ğŸ“</div>
                                    <p id="post-input-label" class="text-gray-600">Klik untuk memilih file</p>
                                    <p class="text-sm text-gray-400 mt-1">Mendukung: JPG, PNG, GIF, MP4, MOV, PDF, DOCX, PPTX, XLSX</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label for="post-title" class="block text-sm font-medium text-gray-700 mb-2">Judul</label>
                            <input type="text" id="post-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Contoh: Kegiatan Bakti Sosial 2025" required>
                        </div>

                        <div>
                            <label for="post-description" class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                            <textarea id="post-description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Deskripsi singkat..."></textarea>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label for="post-date" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Kegiatan</label>
                                <input type="date" id="post-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="">
                            </div>
                            <div>
                                <label for="post-tags" class="block text-sm font-medium text-gray-700 mb-2">Tags (pisah dengan koma)</label>
                                <input type="text" id="post-tags" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="OSIS, Kegiatan, 2025">
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center space-x-2">
                            <span>ğŸ“¤</span><span>Upload</span>
                        </button>
                        <div id="upload-status" class="mt-4 text-center hidden"></div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Kontak -->
        <section id="kontak" class="section-content hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">ğŸ“ Hubungi Kami</h2>
                <p class="text-gray-600">Informasi kontak pengurus OSIS Sekbid 2</p>
            </div>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Sekbid 2</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                <span class="text-blue-600">ğŸ‘‘</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Kabid 2</p>
                                <p class="text-sm text-gray-600">Ramadhani Putra Firdaus</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                <span class="text-green-600">ğŸ¤</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Wabid 2</p>
                                <p class="text-sm text-gray-600">Mutiara Radisty</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                <span class="text-purple-600">ğŸ“</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">Anggota 2</p>
                                <p class="text-sm text-gray-600">Rizky Muhammad Damara</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Informasi Sekolah</h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <span class="text-blue-600 mt-1">ğŸ«</span>
                            <div>
                                <p class="font-medium text-gray-800">Alamat</p>
                                <p class="text-sm text-gray-600">Jl. AH Nasution No 59<br>Cikadut, Bandung, Jawa Barat</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-green-600">ğŸ“±</span>
                            <div>
                                <p class="font-medium text-gray-800">WhatsApp Admin</p>
                                <p class="text-sm text-gray-600">+62 853-5561-4545</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tentang -->
        <section id="tentang" class="section-content hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">â„¹ï¸ Tentang OSIS Sekbid 2</h2>
                <p class="text-gray-600">Mengenal lebih dekat organisasi siswa kami</p>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Sejarah Singkat</h3>
                <p class="text-gray-600 leading-relaxed mb-6">Sekbid 2 mulai aktif menanamkan nilai-nilai etika, sopan santun, dan disiplin seiring kebutuhan pembinaan karakter remaja.</p>
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">Program Kerja</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Proker Jangka Pendek</h4>
                        <p class="text-gray-600 text-sm">Lomba Kebersihan Kelas</p>
                    </div>
                    <div class="border-l-4 border-green-500 pl-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Proker Jangka Sedang</h4>
                        <p class="text-gray-600 text-sm">7K, Poster Digital</p>
                    </div>
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h4 class="font-semibold text-gray-800 mb-2">Proker Jangka Panjang</h4>
                        <p class="text-gray-600 text-sm">Jager, Piket Mabes</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="text-4xl mb-2">ğŸ”</div>
                <h2 class="text-2xl font-bold text-gray-800">Login Admin</h2>
                <p class="text-gray-600 text-sm mt-2">Masukkan username dan password admin</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="admin-username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="admin-username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Masukkan username">
                </div>
                <div>
                    <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="admin-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Masukkan password">
                </div>
                <div id="login-error" class="text-red-600 text-sm text-center hidden"></div>
                <div class="flex space-x-3">
                    <button type="button" onclick="hideLoginModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">Batal</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">Login</button>
                </div>
            </form>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-800 font-medium mb-2">ğŸ‘¥ Hanya Admin yang Diizinkan:</p>
                <p class="text-xs text-blue-600 mt-2 italic">jika ingin login chat admin via wa</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <div class="w-8 h-8 rounded-full flex items-center justify-center">
                    <img src="https://i.ibb.co/V0ZqpRFw/get-removebg-preview.png" alt="logo" class="w-6 h-6 object-contain">
                </div>
                <span class="text-lg font-semibold">OSIS Sekbid 2</span>
            </div>
            <p class="text-gray-400 text-sm">Â© 2025 OSIS Sekbid 2. Semua hak dilindungi.</p>
        </div>
    </footer>

    <script>
    // ===== SUPABASE CONFIG =====
    const SUPABASE_URL = "https://ikogolsygaryiowccmvy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlrb2dvbHN5Z2FyeWlvd2NjbXZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MjQ4MzksImV4cCI6MjA3NjEwMDgzOX0.eFqaSFyvqU3E_KQdq5aFUTpxpoXuXNwdFzo60mpLFgg";
    const BUCKET_NAME = 'uploads';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Admin credentials (demo) - pindahkan ke server di produksi
    const adminCredentials = {
        'rama20': 'mica1620',
        'mdamara2': 'apaajapw12',
        'mutiara2': 'logininaja12'
    };

    // Simple admin state
    function isAdminLoggedIn() { return localStorage.getItem('adminLoggedIn') === 'true'; }
    function getAdminUsername() { return localStorage.getItem('adminUsername') || 'unknown'; }

    // Modal functions
    function showLoginModal() { document.getElementById('login-modal').classList.remove('hidden'); document.getElementById('admin-username').focus(); }
    function hideLoginModal() { document.getElementById('login-modal').classList.add('hidden'); document.getElementById('login-form').reset(); document.getElementById('login-error').classList.add('hidden'); }

    // Login
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        const errorDiv = document.getElementById('login-error');
        if (adminCredentials[username] && adminCredentials[username] === password) {
            localStorage.setItem('adminLoggedIn', 'true');
            localStorage.setItem('adminUsername', username);
            updateAdminUI();
            hideLoginModal();
            showUploadStatus('Login berhasil! Selamat datang, ' + username + ' ğŸ‘‹', 'success');
        } else {
            errorDiv.textContent = 'Username atau password salah!';
            errorDiv.classList.remove('hidden');
        }
    });

    function logout() {
        localStorage.removeItem('adminLoggedIn');
        localStorage.removeItem('adminUsername');
        updateAdminUI();
        showUploadStatus('Logout berhasil! ğŸ‘‹', 'success');
        showSection('beranda');
    }

    function updateAdminUI() {
        const logged = isAdminLoggedIn();
        document.getElementById('login-btn').classList.toggle('hidden', logged);
        document.getElementById('logout-btn').classList.toggle('hidden', !logged);
        document.getElementById('admin-status').classList.toggle('hidden', !logged);
        document.getElementById('upload-access-denied').classList.toggle('hidden', logged);
        document.getElementById('upload-form-container').classList.toggle('hidden', !logged);
        // re-render for admin controls if needed
        loadPosts();
    }

    // Navigation
    function showSection(sectionName) {
        const sections = document.querySelectorAll('.section-content');
        sections.forEach(s => { s.classList.add('hidden'); s.classList.remove('fade-in'); });
        const target = document.getElementById(sectionName);
        if (!target) return;
        target.classList.remove('hidden');
        setTimeout(() => target.classList.add('fade-in'), 10);
        // update nav active
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('bg-blue-600','text-white');
            btn.classList.add('text-gray-600','hover:bg-gray-100');
        });
        const activeBtn = document.getElementById('nav-' + sectionName);
        if (activeBtn) { activeBtn.classList.remove('text-gray-600','hover:bg-gray-100'); activeBtn.classList.add('bg-blue-600','text-white'); }
        if (sectionName === 'posting' || sectionName === 'upload') {
            updateAdminUI();
        }
    }

    // ===== Posts data state =====
    let posts = [];

    async function loadPosts() {
        try {
            const { data, error } = await supabaseClient.from('posts').select('*').order('id', { ascending: false });
            if (error) throw error;
            posts = data || [];
            renderPosts();
        } catch (err) {
            console.error('Gagal load posts:', err);
        }
    }

    // Render posts grid
    function renderPosts() {
        const container = document.getElementById('posts-grid');
        const count = document.getElementById('post-count');
        const filter = document.getElementById('post-filter')?.value || '';
        const search = document.getElementById('post-search')?.value?.toLowerCase() || '';

        let filtered = posts.slice();

        if (filter) {
            if (filter === 'image') filtered = filtered.filter(p => (p.file_type || '').startsWith('image'));
            if (filter === 'video') filtered = filtered.filter(p => (p.file_type || '').startsWith('video'));
            if (filter === 'dokumen') filtered = filtered.filter(p => !((p.file_type||'').startsWith('image') || (p.file_type||'').startsWith('video')));
        }

        if (search) {
            filtered = filtered.filter(p => (p.title || '').toLowerCase().includes(search) || (p.tags || []).join(',').toLowerCase().includes(search));
        }

        count.textContent = `Total posting: ${filtered.length}`;
        if (filtered.length === 0) {
            container.innerHTML = `<div class="text-center text-gray-400 py-12 col-span-full"><div class="text-6xl mb-4">ğŸ“­</div><p>Belum ada posting.</p></div>`;
            return;
        }

        container.innerHTML = filtered.map(p => {
            const isImage = (p.file_type||'').startsWith('image');
            const isVideo = (p.file_type||'').startsWith('video');
            const safeTitle = (p.title || '').replace(/"/g,'&quot;');
            const uploader = p.uploader || '';
            const date = p.date || '';
            const uploaded = p.upload_date || '';
            const fileName = p.file_name || '';
            const fileUrl = p.file_url || '';
            const fileSize = p.file_size ? `${p.file_size} MB` : '';
            // Admin buttons
            const adminBtns = isAdminLoggedIn() ? `
                <div class="flex items-center space-x-2 mt-3">
                  <button onclick="editPost(${p.id})" class="px-3 py-1 bg-yellow-400 text-xs rounded-lg">âœï¸ Edit</button>
                  <button onclick="deletePost(${p.id}, '${fileUrl.split('/').pop()}')" class="px-3 py-1 bg-red-600 text-white text-xs rounded-lg">ğŸ—‘ï¸ Hapus</button>
                </div>` : '';

            // Media HTML
            let mediaHtml = '';
            if (isImage) {
                mediaHtml = `<img src="${fileUrl}" alt="${safeTitle}" class="w-full h-56 object-cover rounded-t-lg">`;
            } else if (isVideo) {
                mediaHtml = `<video controls playsinline class="w-full h-56 object-cover rounded-t-lg" src="${fileUrl}"></video>`;
            } else {
                // document / other
                mediaHtml = `<div class="w-full h-56 flex items-center justify-center bg-gray-50 rounded-t-lg">
                                <div class="text-center">
                                  <div class="text-6xl">ğŸ“„</div>
                                  <div class="mt-2 text-sm text-gray-600">${fileName}</div>
                                </div>
                             </div>`;
            }

            return `
              <div class="bg-white rounded-xl overflow-hidden shadow-md p-0 media-card slide-in">
                ${mediaHtml}
                <div class="p-4">
                  <div class="flex justify-between items-start">
                    <div>
                      <h3 class="font-semibold text-gray-800">${safeTitle}</h3>
                      <p class="text-xs text-gray-500 mt-1">${date ? 'ğŸ“… ' + date : ''} ${uploader ? ' â€¢ ğŸ‘¤ ' + uploader : ''}</p>
                    </div>
                    <div class="text-sm text-gray-500">${fileSize}</div>
                  </div>
                  <p class="text-sm text-gray-600 mt-3 line-clamp-3">${p.description || ''}</p>
                  <div class="mt-4 flex items-center justify-between">
                    <div>
                      ${isImage || isVideo ? `<a href="${fileUrl}" target="_blank" class="text-blue-600 text-sm font-medium">ğŸ” Lihat</a>` : `<a href="${fileUrl}" target="_blank" class="text-blue-600 text-sm font-medium">ğŸ“¥ Download</a>`}
                    </div>
                    ${adminBtns}
                  </div>
                </div>
              </div>
            `;
        }).join('');
    }

    // Search/filter listeners
    document.getElementById('post-filter')?.addEventListener('change', renderPosts);
    document.getElementById('post-search')?.addEventListener('input', () => {
        clearTimeout(window.postSearchTimeout);
        window.postSearchTimeout = setTimeout(renderPosts, 300);
    });

    // ===== Upload handling (single form for all types) =====
    const postInput = document.getElementById('post-input');
    postInput.addEventListener('change', function(e) {
        const label = document.getElementById('post-input-label');
        if (e.target.files.length > 0) {
            const f = e.target.files[0];
            label.textContent = `${f.name} (${(f.size/1024/1024).toFixed(2)} MB)`;
        } else {
            label.textContent = 'Klik untuk memilih file';
        }
    });

    document.getElementById('universal-upload-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        if (!isAdminLoggedIn()) { alert('Hanya admin yang dapat mengupload. Silakan login.'); return; }
        const fileEl = document.getElementById('post-input');
        if (!fileEl.files || fileEl.files.length === 0) { showUploadStatus('Silakan pilih file terlebih dahulu!', 'error'); return; }
        const file = fileEl.files[0];
        const title = document.getElementById('post-title').value || 'Postingan OSIS';
        const description = document.getElementById('post-description').value || '';
        const date = document.getElementById('post-date').value || new Date().toISOString().split('T')[0];
        const tagsRaw = document.getElementById('post-tags').value || '';
        const tags = tagsRaw.split(',').map(t => t.trim()).filter(t => t.length > 0);

        // Validate file size (limit example 150MB) - adjust as needed
        const maxMB = 150;
        if ((file.size / 1024 / 1024) > maxMB) { showUploadStatus(`File terlalu besar. Maks ${maxMB} MB.`, 'error'); return; }

        const fileExt = file.name.split('.').pop().toLowerCase();
        const fileType = file.type || (fileExt === 'pdf' ? 'application/pdf' : '');

        // create unique filename
        const fileName = `${Date.now()}_${file.name.replace(/\s+/g,'_')}`;

        // show loading
        const submitBtn = e.target.querySelector('button[type="submit"]');
        showUploadLoading(true, submitBtn);

        try {
            // upload to Supabase storage
            const { error: uploadError } = await supabaseClient.storage.from(BUCKET_NAME).upload(fileName, file, { cacheControl: '3600', upsert: false });
            if (uploadError) throw uploadError;
            const { data: publicData } = supabaseClient.storage.from(BUCKET_NAME).getPublicUrl(fileName);
            const publicUrl = publicData.publicUrl;

            // determine category (image, video, dokumen)
            let category = 'lainnya';
            if ((fileType||'').startsWith('image')) category = 'image';
            else if ((fileType||'').startsWith('video')) category = 'video';
            else category = 'dokumen';

            // file size MB
            const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);

            // insert metadata to table 'posts' (schema public by default)
            const insertObj = {
                title,
                description,
                category,
                file_url: publicUrl,
                file_type: fileType,
                file_name: file.name,
                date,
                upload_date: new Date().toISOString(),
                file_size: fileSizeMB,
                uploader: getAdminUsername(),
                tags
            };

            const { error: insertError } = await supabaseClient.from('posts').insert(insertObj);
            if (insertError) throw insertError;

            // reset form
            document.getElementById('universal-upload-form').reset();
            document.getElementById('post-input-label').textContent = 'Klik untuk memilih file';
            showUploadStatus('File berhasil diupload ke server! ğŸ‰', 'success');
            await loadPosts();
        } catch (err) {
            console.error('Upload gagal:', err);
            showUploadStatus('Gagal upload: ' + (err.message || err), 'error');
        } finally {
            showUploadLoading(false, submitBtn);
        }
    });

    function showUploadStatus(message, type) {
        const statusDiv = document.getElementById('upload-status');
        statusDiv.className = `mt-4 text-center p-3 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
        statusDiv.textContent = message;
        statusDiv.classList.remove('hidden');
        setTimeout(() => statusDiv.classList.add('hidden'), 4000);
    }
    function showUploadLoading(isLoading, btn) {
        const statusDiv = document.getElementById('upload-status');
        if (isLoading) {
            statusDiv.className = 'mt-4 text-center p-3 rounded-lg bg-blue-100 text-blue-700';
            statusDiv.innerHTML = `<div class="flex items-center justify-center space-x-2"><div class="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div><span>Mengupload...</span></div>`;
            statusDiv.classList.remove('hidden');
            if (btn) { btn.disabled = true; btn.classList.add('opacity-75','cursor-not-allowed'); btn.innerHTML = '<div class="flex items-center justify-center space-x-2"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div><span>Mengupload...</span></div>'; }
        } else {
            if (btn) { btn.disabled = false; btn.classList.remove('opacity-75','cursor-not-allowed'); btn.innerHTML = '<span>ğŸ“¤</span><span>Upload</span>'; }
            setTimeout(() => statusDiv.classList.add('hidden'), 800);
        }
    }

    // ===== Edit / Delete (admin) =====
    async function deletePost(postId, fileName) {
        if (!confirm('Yakin ingin menghapus posting ini?')) return;
        try {
            const { error: delDbErr } = await supabaseClient.from('posts').delete().eq('id', postId);
            if (delDbErr) throw delDbErr;
            // remove file from storage (best-effort)
            try {
                const { error: delStorErr } = await supabaseClient.storage.from(BUCKET_NAME).remove([fileName]);
                if (delStorErr) console.warn('Gagal hapus file storage:', delStorErr.message);
            } catch(e) { console.warn(e); }
            await loadPosts();
            showUploadStatus('Posting berhasil dihapus.', 'success');
        } catch (err) {
            console.error(err);
            alert('Gagal menghapus posting: ' + (err.message || err));
        }
    }

    function editPost(id) {
        const post = posts.find(p => p.id === id);
        if (!post) return alert('Posting tidak ditemukan');
        const newTitle = prompt('Ubah judul:', post.title);
        if (newTitle === null) return;
        const newDesc = prompt('Ubah deskripsi:', post.description || '');
        if (newDesc === null) return;
        (async () => {
            try {
                const { error } = await supabaseClient.from('posts').update({ title: newTitle, description: newDesc }).eq('id', id);
                if (error) throw error;
                showUploadStatus('Posting berhasil diperbarui!', 'success');
                await loadPosts();
            } catch (err) {
                console.error(err);
                showUploadStatus('Gagal memperbarui posting: ' + (err.message || err), 'error');
            }
        })();
    }

    // ===== Init =====
    (async function init() {
        // default date field value
        document.getElementById('post-date').value = new Date().toISOString().split('T')[0];
        await loadPosts();
        updateAdminUI();
        showSection('beranda');
    })();

    // close modal on outside click or ESC
    document.getElementById('login-modal').addEventListener('click', function(e) { if (e.target === this) hideLoginModal(); });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') hideLoginModal(); });

    </script>
</body>
</html>
